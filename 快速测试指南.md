# 🚀 快速测试指南

## 当前状态
✅ 服务间调用成功了！  
⚠️ 但是没有数据（data: null）

---

## 📝 问题原因
数据库中 `gid='15'` 的分组下没有短链接数据。

---

## 🔧 解决方案：添加测试数据

### 方法一：使用SQL脚本（推荐）

#### 1. 在数据库工具中执行
打开 Navicat / DataGrip / MySQL Workbench，执行以下SQL：

```sql
-- 1. 先创建分组
INSERT INTO `t_group` (`gid`, `name`, `username`, `sort_order`, `create_time`, `update_time`, `del_flag`)
VALUES ('15', '测试分组', 'admin', 0, NOW(), NOW(), 0);

-- 2. 创建测试短链接
INSERT INTO `t_link` (
    `domain`, `short_uri`, `full_short_url`, `origin_url`, 
    `click_num`, `gid`, `enable_status`, `created_type`, 
    `valid_date_type`, `describe`, `create_time`, `update_time`, `del_flag`
) VALUES 
('nurl.ink', 'abc123', 'nurl.ink/abc123', 'https://www.baidu.com', 
 0, '15', 1, 0, 0, '测试短链接-百度', NOW(), NOW(), 0),
('nurl.ink', 'xyz789', 'nurl.ink/xyz789', 'https://www.github.com', 
 10, '15', 1, 0, 0, '测试短链接-GitHub', NOW(), NOW(), 0),
('nurl.ink', 'test01', 'nurl.ink/test01', 'https://www.google.com', 
 5, '15', 1, 0, 0, '测试短链接-Google', NOW(), NOW(), 0);

-- 3. 验证数据
SELECT * FROM t_link WHERE gid = '15' AND del_flag = 0;
```

#### 2. 或者导入SQL文件
直接导入 `数据库/创建测试数据.sql` 文件。

---

### 方法二：使用创建接口（推荐）

使用Postman调用创建接口来添加数据：

#### 请求：
```
POST http://127.0.0.1:8902/api/short-link/admin/v1/create
Content-Type: application/json
```

#### 请求体：
```json
{
  "domain": "nurl.ink",
  "originUrl": "https://www.baidu.com",
  "gid": "15",
  "createdType": 0,
  "validDateType": 0,
  "describe": "测试短链接"
}
```

---

## ✅ 验证步骤

### 1. 确认数据已插入
在数据库执行：
```sql
SELECT * FROM t_link WHERE gid = '15' AND del_flag = 0;
```

应该能看到数据。

### 2. 再次测试分页接口
在Postman发送：
```
GET http://127.0.0.1:8902/api/short-link/admin/v1/page?gid=15&current=1&size=10
```

### 3. 预期结果
```json
{
  "code": "0",
  "message": null,
  "data": {
    "records": [
      {
        "id": 1,
        "domain": "nurl.ink",
        "shortUri": "abc123",
        "fullShortUrl": "nurl.ink/abc123",
        "originUrl": "https://www.baidu.com",
        "clickNum": 0,
        "gid": "15",
        "validDateType": 0,
        "validDate": null,
        "createTime": "2025-10-01 10:00:00",
        "describe": "测试短链接-百度",
        "favicon": null
      },
      // ... 更多数据
    ],
    "total": 3,
    "size": 10,
    "current": 1,
    "pages": 1
  },
  "requestId": null,
  "success": true
}
```

---

## 🎯 完整测试流程

### 第1步：准备数据
```sql
-- 在数据库执行，创建测试数据
-- 参考上面的SQL脚本
```

### 第2步：测试创建接口
```
POST http://127.0.0.1:8902/api/short-link/admin/v1/create

{
  "domain": "nurl.ink",
  "originUrl": "https://www.example.com",
  "gid": "15",
  "createdType": 0,
  "validDateType": 0,
  "describe": "新创建的短链接"
}
```

### 第3步：测试分页查询
```
GET http://127.0.0.1:8902/api/short-link/admin/v1/page?gid=15&current=1&size=10
```

### 第4步：验证数据
确认返回的data中有records数据。

---

## 💡 注意事项

### 1. 关于gid
- gid是分组标识，需要先在 `t_group` 表中存在
- 测试时使用统一的gid（如'15'）

### 2. 关于分表
如果使用了ShardingSphere分表，数据可能分散在不同的表中：
- `t_link_0`
- `t_link_1`
- ...

可以执行：
```sql
-- 查看所有分表的数据
SELECT * FROM t_link_0 WHERE gid = '15';
SELECT * FROM t_link_1 WHERE gid = '15';
-- ... 根据你的分表数量
```

### 3. 关于del_flag
- `del_flag = 0` 表示未删除
- `del_flag = 1` 表示已删除
- 查询时要过滤掉已删除的数据

---

## 🐛 常见问题

### Q1: 插入数据时报错 "Duplicate entry"
**原因**: 数据已存在（gid重复或full_short_url重复）

**解决**:
```sql
-- 先删除旧数据
DELETE FROM t_group WHERE gid = '15';
DELETE FROM t_link WHERE gid = '15';
-- 再重新插入
```

### Q2: 查询返回data还是null
**检查清单**:
- [ ] 数据确实插入成功了（SELECT验证）
- [ ] del_flag = 0（未删除）
- [ ] gid匹配
- [ ] 如果有分表，检查所有分表

### Q3: 接口返回空数组 records: []
**可能原因**:
- 数据在其他分表中
- del_flag = 1（已删除）
- gid不匹配

---

## 📊 数据库表关系

```
t_group (分组表)
  ↓ (一对多)
t_link (短链接表)

关联字段: gid
```

---

## 🎓 学习建议

1. **先手动插入测试数据** - 理解表结构
2. **测试查询接口** - 验证服务间调用
3. **测试创建接口** - 完整的业务流程
4. **观察分表机制** - 理解ShardingSphere如何工作

---

## ✅ 成功标志

当你看到这样的返回，就说明一切正常了：

```json
{
  "code": "0",
  "success": true,
  "data": {
    "records": [ /* 有数据 */ ],
    "total": 3,
    "current": 1
  }
}
```

🎉 恭喜你，联调成功！ 